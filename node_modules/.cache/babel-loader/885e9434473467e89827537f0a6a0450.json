{"ast":null,"code":"import _defineProperty from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _createForOfIteratorHelper from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/ava/Documents/newdash/auto-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Bar}from'react-chartjs-2';import{fixVersion,lblsToDisplay,std_lbls,ext_lbls,ps1_lbls,ps2_lbls,all_labels,std_to_auto,ext_to_auto,ps1_to_auto,ps2_to_auto,std_to_cycle,ext_to_cycle,ps1_to_cycle,ps2_to_cycle,executionStatusPerLabelRelease,executionStatusPerLabelAdhoc,nonAdhocFailedTests,statuses,nonAdhocFails}from'../Loader.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var currentCycle='Release Candidate';var ExecutionStatusBar=/*#__PURE__*/function(_Component){_inherits(ExecutionStatusBar,_Component);var _super=_createSuper(ExecutionStatusBar);function ExecutionStatusBar(props){var _this;_classCallCheck(this,ExecutionStatusBar);_this=_super.call(this,props);_this.state={executionStatusData:{labels:lblsToDisplay,datasets:executionStatusPerLabelRelease},totalAutomatedTestsPerLabel:props.totalAutomatedTestsPerLabel,position:props.position};_this.onToggle1=_this.onToggle1.bind(_assertThisInitialized(_this));_this.onToggle2=_this.onToggle2.bind(_assertThisInitialized(_this));_this.onToggle3=_this.onToggle3.bind(_assertThisInitialized(_this));_this.makeBtnActive=_this.makeBtnActive.bind(_assertThisInitialized(_this));_this.onclick=_this.onclick.bind(_assertThisInitialized(_this));_this.getMissingTests=_this.getMissingTests.bind(_assertThisInitialized(_this));return _this;}_createClass(ExecutionStatusBar,[{key:\"makeBtnActive\",value:function makeBtnActive(id){var btns=document.getElementsByClassName(\"btn\");var _iterator=_createForOfIteratorHelper(btns),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var btn=_step.value;btn.classList.remove(\"btn-active\");}}catch(err){_iterator.e(err);}finally{_iterator.f();}var clickedBtn=document.getElementById(\"release\");clickedBtn.classList.add(\"btn-active\");}},{key:\"onToggle1\",value:function onToggle1(){this.setState({executionStatusData:{labels:lblsToDisplay,datasets:executionStatusPerLabelRelease}});currentCycle='Release Candidate';var btns=document.getElementsByClassName(\"btn\");var _iterator2=_createForOfIteratorHelper(btns),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var btn=_step2.value;btn.classList.remove(\"btn-active\");}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}var clickedBtn=document.getElementById(\"release\");clickedBtn.classList.add(\"btn-active\");}},{key:\"onToggle2\",value:function onToggle2(){this.setState({executionStatusData:{labels:lblsToDisplay,datasets:executionStatusPerLabelAdhoc}});currentCycle='Ad hoc';var btns=document.getElementsByClassName(\"btn\");var _iterator3=_createForOfIteratorHelper(btns),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var btn=_step3.value;btn.classList.remove(\"btn-active\");}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}var clickedBtn=document.getElementById(\"adhoc\");clickedBtn.classList.add(\"btn-active\");}},{key:\"onToggle3\",value:function onToggle3(){this.setState({executionStatusData:{labels:lblsToDisplay,datasets:nonAdhocFailedTests}});currentCycle='Non Ad hoc Fails';var btns=document.getElementsByClassName(\"btn\");var _iterator4=_createForOfIteratorHelper(btns),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var btn=_step4.value;btn.classList.remove(\"btn-active\");}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}var clickedBtn=document.getElementById(\"non-adhoc-fails\");clickedBtn.classList.add(\"btn-active\");}},{key:\"getMissingTests\",value:function getMissingTests(label){// show issues that are mismatching between \"in cycle\" and \"auto complete\"\nvar automatedIssues=[],cycledIssues=[],missingTests=[];if(std_lbls.includes(label)){automatedIssues=std_to_auto[label];cycledIssues=std_to_cycle[label];}else if(ext_lbls.includes(label)){automatedIssues=ext_to_auto[label];cycledIssues=ext_to_cycle[label];}else if(ps1_lbls.includes(label)){automatedIssues=ps1_to_auto[label];cycledIssues=ps1_to_cycle[label];}else if(ps2_lbls.includes(label)){automatedIssues=ps2_to_auto[label];cycledIssues=ps2_to_cycle[label];}var _iterator5=_createForOfIteratorHelper(automatedIssues),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var issueId=_step5.value;if(!cycledIssues.includes(issueId)){missingTests.push(issueId);}}//formate issue ids to be used in the url e.g. (53800%2C46878%2C46877%2C46876%2C46875)\n}catch(err){_iterator5.e(err);}finally{_iterator5.f();}var missingIssuesTuple='';for(var _i=0,_missingTests=missingTests;_i<_missingTests.length;_i++){var issue=_missingTests[_i];missingIssuesTuple+=issue+\"%2C\";}//remove last %2C \nif(missingIssuesTuple.includes(\"%2C\"))missingIssuesTuple=missingIssuesTuple.slice(0,missingIssuesTuple.length-3);return missingIssuesTuple;}},{key:\"onclick\",value:function onclick(evt,element){if(element.length>0){var statusInd=element[0].datasetIndex;var label=all_labels[element[0].index];//dynamically generate query link -- change current cycle to something else\nif(!(currentCycle=='Non Ad hoc Fails')){if(statuses[statusInd]!=\"NOT IN CYCLE\"){window.open(\"https://fake/jira/url/to/labels/\"+label+\"project/release/and/fix/version/\"+fixVersion+\"/and/cycle/name/\"+currentCycle+\"and/execution/statuses/\"+statuses[statusInd]+\"%22&view=list&searchType=basic\");}else{window.open(\"https://fake/jira/url/to/issue/keys/within/this/list(\"+this.getMissingTests(label)+\")\");}}else{window.open(\"https://fake/jira/url/to/issue/keys/within/this/list(\"+nonAdhocFails[label]+\")\");}}}},{key:\"render\",value:function render(){var _this2=this,_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"chart\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-secondary btn-sm\",style:{\"margin\":\"5px\"},onClick:this.onToggle1.bind(this),id:\"release\",children:\"Release Candidate\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-secondary btn-sm\",style:{\"margin\":\"5px\"},onClick:this.onToggle2.bind(this),id:\"adhoc\",children:\"Ad hoc\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-secondary btn-sm\",style:{\"margin\":\"5px\"},onClick:this.onToggle3.bind(this),id:\"non-adhoc-fails\",children:\"Non Ad hoc Fails or CRC Fails\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Bar,{id:\"executionStatus\",data:this.state.executionStatusData,options:(_ref={plugins:{tooltip:{callbacks:{footer:function footer(context){if(_this2.props.totalAutomatedTestsPerLabel===undefined){return;}var indexOfLabelHovered=context[0].dataIndex;return'Total: '+_this2.props.totalAutomatedTestsPerLabel[indexOfLabelHovered];}}}},maintainAspectRatio:false,responsive:true,title:{display:false,text:'Execution Status per Label',fontSize:25}},_defineProperty(_ref,\"responsive\",true),_defineProperty(_ref,\"indexAxis\",'y'),_defineProperty(_ref,\"scales\",{x:{stacked:true,barPercentage:0.2,ticks:{autoSkip:false}},y:{stacked:true,ticks:{autoSkip:false}}}),_defineProperty(_ref,\"legend\",{display:false,position:'bottom'}),_defineProperty(_ref,\"onClick\",this.onclick),_ref)})]});}}]);return ExecutionStatusBar;}(Component);export default ExecutionStatusBar;","map":{"version":3,"sources":["/home/ava/Documents/newdash/auto-dash/src/components/ExecutionStatusBar.jsx"],"names":["React","Component","Bar","fixVersion","lblsToDisplay","std_lbls","ext_lbls","ps1_lbls","ps2_lbls","all_labels","std_to_auto","ext_to_auto","ps1_to_auto","ps2_to_auto","std_to_cycle","ext_to_cycle","ps1_to_cycle","ps2_to_cycle","executionStatusPerLabelRelease","executionStatusPerLabelAdhoc","nonAdhocFailedTests","statuses","nonAdhocFails","currentCycle","ExecutionStatusBar","props","state","executionStatusData","labels","datasets","totalAutomatedTestsPerLabel","position","onToggle1","bind","onToggle2","onToggle3","makeBtnActive","onclick","getMissingTests","id","btns","document","getElementsByClassName","btn","classList","remove","clickedBtn","getElementById","add","setState","label","automatedIssues","cycledIssues","missingTests","includes","issueId","push","missingIssuesTuple","issue","slice","length","evt","element","statusInd","datasetIndex","index","window","open","plugins","tooltip","callbacks","footer","context","undefined","indexOfLabelHovered","dataIndex","maintainAspectRatio","responsive","title","display","text","fontSize","x","stacked","barPercentage","ticks","autoSkip","y"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Bar } from 'react-chartjs-2';\r\nimport { fixVersion, lblsToDisplay, std_lbls, ext_lbls, ps1_lbls, ps2_lbls, all_labels, \r\n          std_to_auto, ext_to_auto, ps1_to_auto, ps2_to_auto, std_to_cycle, ext_to_cycle, ps1_to_cycle, ps2_to_cycle, \r\n          executionStatusPerLabelRelease, executionStatusPerLabelAdhoc, nonAdhocFailedTests,\r\n          statuses, nonAdhocFails } from '../Loader.js';\r\n\r\nlet currentCycle = 'Release Candidate';\r\n\r\nclass ExecutionStatusBar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      executionStatusData: {\r\n        labels: lblsToDisplay,\r\n        datasets: executionStatusPerLabelRelease\r\n      },\r\n      totalAutomatedTestsPerLabel: props.totalAutomatedTestsPerLabel,\r\n      position: props.position,\r\n\r\n    }\r\n    this.onToggle1 = this.onToggle1.bind(this);\r\n    this.onToggle2 = this.onToggle2.bind(this);\r\n    this.onToggle3 = this.onToggle3.bind(this);\r\n    this.makeBtnActive = this.makeBtnActive.bind(this);\r\n    this.onclick = this.onclick.bind(this);\r\n    this.getMissingTests = this.getMissingTests.bind(this);\r\n  }\r\n\r\n  makeBtnActive(id) {\r\n    var btns = document.getElementsByClassName(\"btn\");\r\n    for (const btn of btns) btn.classList.remove(\"btn-active\");\r\n    var clickedBtn = document.getElementById(\"release\");\r\n    clickedBtn.classList.add(\"btn-active\");\r\n  }\r\n\r\n  onToggle1() {\r\n    this.setState({\r\n      executionStatusData: {\r\n        labels: lblsToDisplay,\r\n        datasets: executionStatusPerLabelRelease\r\n      },\r\n    });\r\n    currentCycle = 'Release Candidate'\r\n    var btns = document.getElementsByClassName(\"btn\");\r\n    for (const btn of btns) btn.classList.remove(\"btn-active\");\r\n    var clickedBtn = document.getElementById(\"release\");\r\n    clickedBtn.classList.add(\"btn-active\");\r\n  }\r\n  onToggle2() {\r\n    this.setState({\r\n      executionStatusData: {\r\n        labels: lblsToDisplay,\r\n        datasets: executionStatusPerLabelAdhoc\r\n      },\r\n    });\r\n    currentCycle = 'Ad hoc';\r\n    var btns = document.getElementsByClassName(\"btn\");\r\n    for (const btn of btns) btn.classList.remove(\"btn-active\");\r\n    var clickedBtn = document.getElementById(\"adhoc\");\r\n    clickedBtn.classList.add(\"btn-active\");\r\n  }\r\n  onToggle3() {\r\n    this.setState({\r\n      executionStatusData: {\r\n        labels: lblsToDisplay,\r\n        datasets: nonAdhocFailedTests\r\n      },\r\n    });\r\n    currentCycle = 'Non Ad hoc Fails'\r\n    var btns = document.getElementsByClassName(\"btn\");\r\n    for (const btn of btns) btn.classList.remove(\"btn-active\");\r\n    var clickedBtn = document.getElementById(\"non-adhoc-fails\");\r\n    clickedBtn.classList.add(\"btn-active\");\r\n  }\r\n\r\n  getMissingTests(label) {\r\n    // show issues that are mismatching between \"in cycle\" and \"auto complete\"\r\n    let automatedIssues = [], cycledIssues = [], missingTests = [];\r\n    if (std_lbls.includes(label)) {\r\n      automatedIssues = std_to_auto[label];\r\n      cycledIssues = std_to_cycle[label];\r\n    } else if (ext_lbls.includes(label)) {\r\n      automatedIssues = ext_to_auto[label];\r\n      cycledIssues = ext_to_cycle[label];\r\n    } else if (ps1_lbls.includes(label)) {\r\n      automatedIssues = ps1_to_auto[label];\r\n      cycledIssues = ps1_to_cycle[label];\r\n    } else if (ps2_lbls.includes(label)) {\r\n      automatedIssues = ps2_to_auto[label];\r\n      cycledIssues = ps2_to_cycle[label];\r\n    }\r\n    for (let issueId of automatedIssues) {\r\n      if (!cycledIssues.includes(issueId)) {\r\n        missingTests.push(issueId)\r\n      }\r\n    }\r\n    //formate issue ids to be used in the url e.g. (53800%2C46878%2C46877%2C46876%2C46875)\r\n    let missingIssuesTuple = ''\r\n    for (let issue of missingTests)\r\n      missingIssuesTuple += issue + \"%2C\";\r\n    //remove last %2C \r\n    if (missingIssuesTuple.includes(\"%2C\"))\r\n      missingIssuesTuple = missingIssuesTuple.slice(0, missingIssuesTuple.length - 3)\r\n    return missingIssuesTuple;\r\n  }\r\n\r\n  onclick(evt, element) {\r\n    if (element.length > 0) {\r\n      var statusInd = element[0].datasetIndex;\r\n      var label = all_labels[element[0].index];\r\n      //dynamically generate query link -- change current cycle to something else\r\n      if (!(currentCycle == 'Non Ad hoc Fails')) {\r\n        if (statuses[statusInd] != \"NOT IN CYCLE\") {\r\n          window.open(\"https://fake/jira/url/to/labels/\" + label + \"project/release/and/fix/version/\" + fixVersion + \"/and/cycle/name/\" + currentCycle + \"and/execution/statuses/\" + statuses[statusInd] + \"%22&view=list&searchType=basic\");\r\n        } else {\r\n          window.open(\"https://fake/jira/url/to/issue/keys/within/this/list(\" + this.getMissingTests(label) + \")\");\r\n        }\r\n      } else {\r\n        window.open(\"https://fake/jira/url/to/issue/keys/within/this/list(\" + nonAdhocFails[label] + \")\");\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"chart\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" style={{ \"margin\": \"5px\" }} onClick={this.onToggle1.bind(this)} id=\"release\">Release Candidate</button>\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" style={{ \"margin\": \"5px\" }} onClick={this.onToggle2.bind(this)} id=\"adhoc\">Ad hoc</button>\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" style={{ \"margin\": \"5px\"}} onClick={this.onToggle3.bind(this)} id=\"non-adhoc-fails\">Non Ad hoc Fails or CRC Fails</button>\r\n        <br/>\r\n        <br/>\r\n        <Bar id=\"executionStatus\"\r\n          data={this.state.executionStatusData}\r\n          options={{\r\n            plugins: {\r\n              tooltip: {\r\n                callbacks: {\r\n                  footer: (context) => {\r\n                    if (this.props.totalAutomatedTestsPerLabel === undefined) { return }\r\n                    let indexOfLabelHovered = context[0].dataIndex;\r\n                    return 'Total: ' + this.props.totalAutomatedTestsPerLabel[indexOfLabelHovered];\r\n\r\n                  }\r\n                }\r\n              }\r\n            },\r\n            maintainAspectRatio: false,\r\n            responsive: true,\r\n            title: {\r\n              display: false,\r\n              text: 'Execution Status per Label',\r\n              fontSize: 25\r\n            },\r\n            responsive: true,\r\n            indexAxis: 'y',\r\n            scales: {\r\n              x: {\r\n                stacked: true,\r\n                barPercentage: 0.2,\r\n                ticks: {\r\n                  autoSkip: false\r\n                }\r\n              },\r\n              y: {\r\n                stacked: true,\r\n                ticks: {\r\n                  autoSkip: false\r\n                }\r\n              }\r\n            },\r\n            legend: {\r\n              display: false,\r\n              position: 'bottom'\r\n            },\r\n            onClick: this.onclick\r\n          }}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default ExecutionStatusBar;"]},"metadata":{},"sourceType":"module"}